# 마진 현황 - 엑셀 데이터 구조 분석

*최종 업데이트: 2026-02-21*

---

## 1. 파일 목록

| 파일명 | 설명 | 용도 |
|--------|------|------|
| 견적서양식.xlsx | 견적서 템플릿 | 브랜드에게 발행하는 견적서 양식 |
| 견적서양식_실제예시.xlsx | 실제 견적서 예시 | 파싱 로직 검증용 |
| 총매출지출_정산시트.xlsx | 정산 시트 (4개 탭) | 매출/지출/마진 관리 원본 |

---

## 2. 견적서 (브랜드 → 대행사)

### 전체 레이아웃 (35행 x 6열)

```
┌─────────────────────────────────────────────────────────────┐
│ 행 1-2   : 제목 + 작성일자                                    │
│ 행 3     : (빈 행)                                           │
│ 행 4-9   : 회사 정보 (고객사 A열 / 대행사 D열)                  │
│ 행 10    : (빈 행)                                           │
│ 행 11    : 총 합계금액 (D11)                                  │
│ 행 12    : (빈 행)                                           │
│ 행 13    : 품목 헤더 (품명/규격/수량/단가/총액)                  │
│ 행 14+   : 품목 데이터                                        │
│ 행 24-26 : 공급가/부가세/합계                                  │
│ 행 28-30 : 계좌/유효기간                                      │
└─────────────────────────────────────────────────────────────┘
```

### 핵심 셀 위치

| 셀 | 내용 | 예시 |
|----|------|------|
| B1 | 제목 | "견  적  서" |
| F2 | 작성일자 | 46029 (엑셀날짜) → `new Date((N - 25569) * 86400 * 1000)` |
| A5 | 고객사(브랜드) | "나우팜에이치앤비", "어댑트" |
| D5 | 대행사 | "강우메이커스 (Kangwoo AD)" |
| F6 | 대행사 담당자 | "김지훈", "이경태" |
| D11 | 총 합계금액 | 181390, 65798095 |
| F24 | 공급가총액 | 품목 총액의 합 |
| F25 | 부가세 | 공급가 × 0.1 |
| F26 | 합계금액 | 공급가 + 부가세 = D11 |

### 품목 데이터 (행 14~)

| 열 | 내용 | 타입 |
|----|------|------|
| A | 품명 | TEXT |
| C | 규격 | "EA" (고정) |
| D | 수량 | NUMBER |
| E | 단가 | NUMBER |
| F | 총액 | `= D × E` |

### 품명 분류 로직

| 분류 | 키워드 | 예시 |
|------|--------|------|
| 진행비(리뷰) | "리뷰", "구매평" | "쿠팡 리뷰작성", "구매대행 및 리뷰작성" |
| 제품비 | "제품비", "입금대행", `MM/DD` 패턴 | "제품비 입금대행 쿠팡 - 닥터포헤어 씨크닝 헤어세럼" |
| 택배대행 | "택배" | "택배대행" |
| 기타 | 위에 해당 안됨 | "직전 회차 차액" |

```javascript
function classifyItem(productName) {
  const name = productName.toLowerCase();
  if (name.includes('리뷰') || name.includes('구매평')) return 'review';
  if (name.includes('택배')) return 'delivery';
  if (name.includes('제품비') || name.includes('입금대행') || /^\d{1,2}\/\d{1,2}/.test(name)) return 'product';
  return 'other';
}
```

### 분석 완료된 실제 견적서

| 파일명 | 브랜드 | 총액 | 특징 |
|--------|--------|------|------|
| 260107나우팜에이치앤비 견적서.xlsx | 나우팜에이치앤비 | 181,390원 | 소규모 (2품목) |
| 어댑트 정산서_강우애드(260106).xlsx | 어댑트 | 65,798,095원 | 대규모 (249행) |
| 20260106 닥터포헤어 견적서.xlsx | 스타트뷰(닥터포헤어) | 2,156,660원 | 중규모 (4품목) |
| 20260102 누카 견적서.xlsx | 누카 | 2,136,750원 | 중규모 (5품목, 택배포함) |

---

## 3. 정산 시트 - 매출 (시트1)

> 범위: A1:Y5002 (약 5000행), 행 1: 안내문, 행 2: 헤더

### 컬럼 구조

| 컬럼 | 필드명 | 입력/자동 | 수식 |
|------|--------|----------|------|
| **A** | **정산ID** | **입력** | - |
| **B** | **업체명** | **입력** | - |
| **C** | **진행비 단가** | **입력** | - |
| **D** | **진행 수량** | **입력** | - |
| E | 진행비+vat | 자동 | `= C × 1.1` |
| F | 진행비 총 공급가액 | 자동 | `= C × D` |
| G | 진행비 총 입금액(+vat) | 자동 | `= F × 1.1` |
| **H** | **제품명** | **입력** | - |
| **I** | **제품 수량** | **입력** | - |
| **J** | **제품비 단가** | **입력** | - |
| K | 제품비+vat | 자동 | `= J × 1.1` |
| L | 제품별 공급가액 | 자동 | `= I × J` |
| M | 제품별 총 입금액(+vat) | 자동 | `= L × 1.1` |
| N | 제품비 총 공급가액 | 자동 | `= SUM(L) for 같은 정산ID` |
| O | 제품비 총 입금액(+vat) | 자동 | `= N × 1.1` |
| **P** | **택배대행 단가** | **입력** | - |
| **Q** | **택배 수량** | **입력** | - |
| R | 택배대행단가(+vat) | 자동 | `= P × 1.1` |
| S | 택배대행 총 공급가 | 자동 | `= P × Q` |
| T | 택배대행 총 입금액(+vat) | 자동 | `= S × 1.1` |
| U | 첫행(숨김) | 자동 | 1=그룹 첫행, 0=추가 제품행 |

### 데이터 그룹핑 패턴

같은 **정산ID**로 여러 행이 존재 (제품이 여러 개일 때):

```
행 1: 260106더포레쿠팡 | 더포레 | 2500 | 80 | ... | 깍두기   | 30 | 8700 | ... | (빈) | (빈) | 1  ← 첫행
행 2: 260106더포레쿠팡 | 더포레 |      |    | ... | 멸치     | 30 | 9300 | ... |      |      | 0  ← 추가
행 3: 260106더포레쿠팡 | 더포레 |      |    | ... | 오이소박이| 20 |14300 | ... |      |      | 0  ← 추가
```

- **첫 행(U=1)**: 진행비(C,D), 택배(P,Q) 값 존재, 제품비 총 합계(N,O) 계산
- **추가 행(U=0)**: 제품 정보(H,I,J)만 존재, 나머지 빈값

### 입력 필드 요약 (검정색 = 수동 입력)

| 필드 | 위치 | 설명 |
|------|------|------|
| 정산ID | A | `날짜(YYMMDD)+업체명+플랫폼` 형식 |
| 업체명 | B | 브랜드 이름 |
| 진행비 | C | 건당 진행비 단가 (브랜드에 청구) |
| 진행 수량 | D | 총 진행 건수 |
| 제품명 | H | 제품명 (여러 행 가능) |
| 제품 수량 | I | 각 제품별 수량 |
| 제품비 | J | 각 제품별 단가 |
| 택배대행 단가 | P | 택배 건당 단가 |
| 택배 수량 | Q | 택배 건수 |

---

## 4. 정산 시트 - 지출 (시트2)

> 범위: A1:Z5205, 행 1: 안내문("진행비(실비) = 리뷰 및 진행자 비용 합으로 작성"), 행 2: 헤더

### 컬럼 구조

| 컬럼 | 필드명 | 입력/자동 | 수식 |
|------|--------|----------|------|
| A | 정산ID | 매출 참조 | - |
| B | 업체명 | 매출 참조 | - |
| **C** | **진행비(실비)** | **유일한 입력** | - |
| D | 진행비 수량 | 매출 참조 | `= 매출.D` |
| E | 진행비 총 지출 | 자동 | `= C × D` |
| F | 제품명 | 매출 참조 | `= 매출.H` |
| G | 제품 수량 | 매출 참조 | `= 매출.I` |
| H | 제품비(실비) | 매출 참조 | `= 매출.J` (매출=지출 동일) |
| I | 제품별 지출액 | 자동 | `= G × H` |
| J | 제품비 총 지출액 | 자동 | `= SUM(I) for 같은 정산ID` |
| K | 택배대행(실비)+vat | 설정값 | 고정 2,750원 (총정리 설정) |
| L | 택배 수량 | 매출 참조 | `= 매출.Q` |
| M | 택배대행 총 지출 | 자동 | `= K × L` |
| N | 총 지출 액 | 자동 | `= E + J + M` |
| O | 첫행(숨김) | 자동 | 1/0 |

### 핵심 포인트

- **직접 입력하는 값: 진행비(실비) 단가(C) 하나뿐**
- 제품비는 매출 시트의 값과 동일하게 사용 (브랜드에 청구하는 금액 = 실제 제품 구매 금액)
- 택배대행 실비는 고정 2,750원 (총정리 시트의 설정값)
- 나머지는 모두 매출 시트에서 참조하거나 자동 계산

### 마진 발생 구조

```
매출 진행비 단가(C) vs 지출 진행비(실비)(C) 차이 → 진행비 마진
매출 택배단가(P) vs 지출 택배실비(K=2750) 차이 → 택배 마진
제품비는 매출 = 지출 동일 → 마진 없음
```

---

## 5. 정산 시트 - 총정리 (시트3)

> 범위: A1:F1000

### 전체 요약 (Row 1~6)

| 행 | 항목 | 계산식 |
|----|------|--------|
| 2 | 총 매출액 공급가 | `= SUM(매출.F + 매출.N + 매출.S)` 전체 합 |
| 3 | 총 매출 입금액(+vat) | `= Row2 × 1.1` |
| 4 | 부가세 | `= Row2 × 0.1` |
| 5 | 총 지출 액 | `= SUM(지출.N)` 전체 합 (급여/세금 등 추가 가능) |
| 6 | 순 마진 | `= Row2 - Row5` |

### 정산ID별 요약 (Row 8~)

| 컬럼 | 필드명 | 계산식 |
|------|--------|--------|
| A | 정산ID | 매출/지출의 고유 정산ID |
| B | 업체명 | |
| C | 매출 공급가 | `= 진행비총공급가(F) + 제품비총공급가(N) + 택배총공급가(S)` |
| D | 매출 입금액(+vat) | `= C × 1.1` |
| E | 총 지출 | `= 지출.N` (해당 정산ID) |
| F | 순 마진 | `= C - E` |

### 설정값 (Row 18~19)

| 행 | 항목 | 값 |
|----|------|-----|
| 19 | 택배대행(실비)+vat 단가 | 2,750원 |

---

## 6. 정산 시트 - 일자별 계산서 발행 (시트4)

> 현재 구현 대상 아님

라인업솔루션 → 강우메이커스로 발행하는 세금계산서 금액 추적.

| 컬럼 | 내용 |
|------|------|
| A | 날짜 (엑셀날짜) |
| B | 발행 요청 날짜 |
| C | 발행 금액 |
| D | 발행 확인 (완/미완) |
| E | 추가/수정 사항 |

---

## 7. 데이터 흐름 요약

```
견적서 업로드 (.xlsx)
  │
  ├─ 자동 파싱 (classifyItem)
  │   ├─ review  → 진행비 단가/수량
  │   ├─ product → 제품명/수량/단가
  │   ├─ delivery → 택배 단가/수량
  │   └─ other   → 메모
  │
  ▼
settlements 테이블 (매출 base 데이터 생성)
  │
  ├─ 매출 탭: 입력값 + 자동 계산 (×1.1, 합계 등)
  │
  ├─ 지출 탭: 매출 참조 + 진행비(실비) 입력 + 자동 계산
  │
  └─ 총정리 탭: 전체/정산ID별 매출·지출·순마진 집계
```

---

## 8. 주의사항

1. **엑셀 날짜**: 숫자 → `new Date((N - 25569) * 86400 * 1000)`
2. **병합 셀**: A-B 열이 병합되는 경우 있음
3. **빈 행**: 총액이 0인 행은 무시
4. **대규모 파일**: 어댑트 같은 경우 249행까지 데이터
5. **줄바꿈**: 품명에 `\r\n` 포함 가능
6. **정산ID 형식**: `YYMMDD + 업체명 + 플랫폼` (예: "260106조이쿠팡")
7. **그룹 첫행 판별**: U열=1이면 첫행 (진행비/택배 값 존재), U열=0이면 추가 제품행
