# 견적서 엑셀 파일 포맷 분석

## 분석 대상 파일

| 파일명 | 브랜드 | 총액 | 특징 |
|--------|--------|------|------|
| 260107나우팜에이치앤비 견적서.xlsx | 나우팜에이치앤비 | 181,390원 | 소규모 (2품목) |
| 어댑트 정산서_강우애드(260106).xlsx | 어댑트 | 65,798,095원 | 대규모 (249행, 다수 품목) |
| 20260106 닥터포헤어 견적서.xlsx | 스타트뷰(닥터포헤어) | 2,156,660원 | 중규모 (4품목) |
| 20260102 누카 견적서.xlsx | 누카 | 2,136,750원 | 중규모 (5품목, 택배대행 포함) |

---

## 엑셀 파일 공통 구조

### 전체 레이아웃 (35행 x 6열 기본)

```
┌─────────────────────────────────────────────────────────────────┐
│ 행 1-2   : 제목 영역 (견적서 제목 + 작성일자)                      │
│ 행 3     : (빈 행)                                               │
│ 행 4-9   : 회사 정보 영역 (고객사 + 대행사)                        │
│ 행 10    : (빈 행)                                               │
│ 행 11    : 총 합계금액                                            │
│ 행 12    : (빈 행)                                               │
│ 행 13    : 품목 테이블 헤더                                       │
│ 행 14-23 : 품목 데이터 (최대 10행, 대규모 파일은 더 많음)           │
│ 행 24-26 : 금액 요약 (공급가, 부가세, 합계)                        │
│ 행 27    : (빈 행)                                               │
│ 행 28-30 : 안내 정보 (계좌, 유효기간)                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 상세 셀 위치 매핑

### 1. 제목 영역 (행 1-2)

| 셀 | 내용 | 예시 |
|----|------|------|
| B1 | 제목 | "견  적  서" |
| F1 | 라벨 | "작성일자" |
| F2 | 작성일자 | 46029 (엑셀 날짜 숫자) |

**엑셀 날짜 변환:**
- 46024 = 2026-01-02
- 46028 = 2026-01-06
- 46029 = 2026-01-07
- 변환 공식: `new Date((엑셀날짜 - 25569) * 86400 * 1000)`

### 2. 회사 정보 영역 (행 4-9)

| 셀 | 내용 | 설명 |
|----|------|------|
| A4 | "Company Information" | 고객사 영역 라벨 |
| D4 | "Agency Information" | 대행사 영역 라벨 |
| **A5** | **고객사(브랜드) 이름** | 예: "나우팜에이치앤비", "어댑트", "누카" |
| **D5** | **대행사 이름** | 예: "강우메이커스 (Kangwoo AD)", "강우애드 (Kangwoo AD)" |
| A6 | "담당자" 라벨 | |
| B6 | 고객사 담당자명 | (선택) |
| D6 | "담당자명" 또는 "대표자명" 라벨 | |
| F6 | 대행사 담당자명 | 예: "김지훈", "이경태", "김민근" |
| D7 | "사업자등록번호" 또는 "담당자" 라벨 | |
| F7 | 사업자번호 또는 담당자명 | 예: "432-23-01845" |
| D8 | "TEL" 라벨 | |
| F8 | 전화번호 | 예: "010-7531-3638" |
| D9 | "이메일" 라벨 | |
| F9 | 이메일 | 예: "kangwooco@naver.com" |

### 3. 총 합계금액 (행 11)

| 셀 | 내용 | 예시 |
|----|------|------|
| A11 | "총 합계금액" 라벨 | |
| **D11** | **총 합계금액 값** | 181390, 65798095, 2156660 등 |

### 4. 품목 테이블 (행 13부터)

#### 헤더 (행 13)

| 열 | A | B | C | D | E | F |
|----|---|---|---|---|---|---|
| 13 | 품명 | (병합) | 규격 | 수량 | 단가 | 총액 |

#### 데이터 (행 14부터)

| 열 | 내용 | 타입 | 예시 |
|----|------|------|------|
| **A** | **품명** | TEXT | "쿠팡 리뷰작성", "제품비 입금대행 ..." |
| B | (빈칸 또는 병합) | - | |
| **C** | **규격** | TEXT | "EA" (고정) |
| **D** | **수량** | NUMBER | 10, 5, 1 |
| **E** | **단가** | NUMBER | 2000, 14490, 299000 |
| **F** | **총액** | NUMBER | 수량 × 단가 |

### 5. 금액 요약 (행 24-26)

| 셀 | 내용 | 계산 |
|----|------|------|
| C24 | "공급가총액" 라벨 | |
| **F24** | **공급가총액 값** | 품목 총액의 합 |
| C25 | "부가세" 라벨 | |
| **F25** | **부가세 값** | 공급가 × 0.1 |
| C26 | "합계금액" 라벨 | |
| **F26** | **합계금액 값** | 공급가 + 부가세 = D11 값과 동일 |

### 6. 안내 정보 (행 28-30)

| 셀 | 내용 |
|----|------|
| A28 | " Information" |
| A29 | " · 입금계좌안내 : 국민은행 893801-00-104943 김민근(강우메이커스)" |
| A30 | " · 견적유효기간 : 작성 후 20일 이내" |

---

## 품명 분류 패턴

### 1. 리뷰 작성비

| 패턴 | 예시 |
|------|------|
| `{플랫폼} 리뷰작성` | "쿠팡 리뷰작성" |
| `{브랜드} 리뷰 작성` | "오브제 리뷰 작성" |
| `구매대행 및 리뷰작성` | "구매대행 및 리뷰작성" |
| `리뷰 작업` | "리뷰 작업" |

**키워드:** "리뷰"

### 2. 제품비 입금대행

| 패턴 | 예시 |
|------|------|
| `제품비 입금대행 {플랫폼} - {제품명}` | "제품비 입금대행 쿠팡 - 닥터포헤어 씨크닝 헤어세럼" |
| `제품비 ({플랫폼} {제품명})` | "제품비 (쿠팡 누카 커스텀체어 X900 PRO)" |
| `{날짜} {브랜드} {제품상세}` | "12/31 오브제 포어 제로 오일 컨트롤 선크림 SPF50+ PA++++, 50ml, 1개" |

**키워드:** "제품비", "입금대행" 또는 날짜 패턴 (MM/DD)

### 3. 택배대행

| 패턴 | 예시 |
|------|------|
| `택배대행` | "택배대행" |

**키워드:** "택배"

### 4. 기타

| 패턴 | 예시 |
|------|------|
| `직전 회차 차액` | "직전 회차 차액" |

---

## 파일별 상세 데이터

### 파일 1: 260107나우팜에이치앤비 견적서.xlsx

```
브랜드: 나우팜에이치앤비
대행사: 강우메이커스 (Kangwoo AD)
작성일: 2026-01-07
담당자: 김지훈

품목:
1. 쿠팡 리뷰작성          | EA | 10건 | 2,000원 | 20,000원
2. 제품비 입금대행 메르필... | EA | 10건 | 14,490원 | 144,900원

공급가: 164,900원
부가세: 16,490원
합계: 181,390원
```

### 파일 2: 어댑트 정산서_강우애드(260106).xlsx

```
브랜드: 어댑트
대행사: 강우애드 (Kangwoo AD)
작성일: 2026-01-06
담당자: 이경태

품목: (총 249행, 주요 항목만)
1. 오브제 리뷰 작성        | EA | 855건 | 800원 | 684,000원
2. 12/31 오브제 포어 제로... | EA | 10건 | 17,900원 | 179,000원
3. 12/31 오브제 올인원...   | EA | 5건 | 15,790원 | 78,950원
... (다수 품목)

특징:
- 날짜별로 품목 그룹화 (12/31, 12/29, 12/27, 12/25, 12/24 ...)
- 대량 리뷰 건수 (855건)

합계: 65,798,095원
```

### 파일 3: 20260106 닥터포헤어 견적서.xlsx

```
브랜드: 스타트뷰 (닥터포헤어)
대행사: 강우애드 (Kangwoo AD)
작성일: 2026-01-06
담당자: 김민근

품목:
1. 구매대행 및 리뷰작성     | EA | 70건 | 2,000원 | 140,000원
2. 제품비 - 씨크닝 헤어세럼  | EA | 50건 | 30,600원 | 1,530,000원
3. 제품비 - 폴리젠 플러스 샴푸 | EA | 20건 | 13,590원 | 271,800원
4. 직전 회차 차액          | EA | 1건 | 18,800원 | 18,800원

공급가: 1,960,600원
부가세: 196,060원
합계: 2,156,660원
```

### 파일 4: 20260102 누카 견적서.xlsx

```
브랜드: 누카
대행사: 강우애드 (Kangwoo AD)
작성일: 2026-01-02
담당자: (없음)

품목:
1. 리뷰 작업              | EA | 5건 | 2,500원 | 12,500원
2. 제품비 (쿠팡 X900 PRO)  | EA | 1건 | 299,000원 | 299,000원
3. 제품비 (쿠팡 G900-MS)   | EA | 1건 | 329,000원 | 329,000원
4. 제품비 (네이버 E60)     | EA | 3건 | 429,000원 | 1,287,000원
5. 택배대행               | EA | 5건 | 3,000원 | 15,000원

공급가: 1,942,500원
부가세: 194,250원
합계: 2,136,750원
```

---

## DB 매핑 제안

### 자동 추출 가능한 필드

| 견적서 위치 | DB 필드 | 용도 |
|------------|---------|------|
| A5 (고객사명) | Campaign/MonthlyBrand 매칭 | 브랜드 식별 |
| F2 (작성일자) | 정산 기준일 | 날짜 |
| D11 (총합계) | 총 정산금액 | 검증용 |
| 품목 A열 (품명) | 비용 분류 | 리뷰비/제품비/택배비 구분 |
| 품목 D열 (수량) | 건수 | 총 구매건수 |
| 품목 E열 (단가) | 단가 | 리뷰 단가, 제품 단가 |
| 품목 F열 (총액) | 소계 | 항목별 금액 |
| F24 (공급가) | 공급가 | 마진 계산용 |
| F25 (부가세) | 부가세 | 마진 계산용 |

### 비용 분류 로직

```javascript
function classifyItem(productName) {
  const name = productName.toLowerCase();

  if (name.includes('리뷰')) {
    return 'review_cost';      // 리뷰비
  }
  if (name.includes('택배')) {
    return 'delivery_cost';    // 택배비
  }
  if (name.includes('제품비') || name.includes('입금대행') || /^\d{1,2}\/\d{1,2}/.test(name)) {
    return 'product_cost';     // 제품비
  }
  return 'other_cost';         // 기타비용
}
```

---

## 주의사항

1. **날짜 형식**: 엑셀 날짜 숫자를 JavaScript Date로 변환 필요
2. **병합 셀**: A-B 열이 병합되어 있는 경우가 있음
3. **빈 행**: 데이터 사이에 빈 행이 있을 수 있음 (총액이 0인 행)
4. **대규모 파일**: 어댑트 같은 경우 249행까지 데이터가 있음
5. **품명 파싱**: 줄바꿈 문자(`\r\n`)가 포함된 경우 있음

---

## 향후 작업

- [ ] 엑셀 업로드 UI 구현 (AdminMarginDashboard)
- [ ] 엑셀 파싱 함수 구현 (xlsx 라이브러리 사용)
- [ ] 브랜드명으로 Campaign/MonthlyBrand 매칭
- [ ] 비용 분류 및 DB 저장 로직
- [ ] 업로드 결과 미리보기 기능
- [ ] 기존 마진 데이터와 병합/덮어쓰기 옵션

---

*최종 업데이트: 2026-01-21*
